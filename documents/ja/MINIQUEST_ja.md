# プロローグ

かつて、一攫千金を夢見た起業家がいました。過去にいくつかのビジネス失敗を経験した彼は、新たな事業としてオンラインゲーム会社の立ち上げを決意しました。

権威主義的な社長である彼は、自らゲームのコンセプトとデザインを考案し、非常に安価な開発パートナーを雇い、なんとかサービスを立ち上げることに成功しました。

そのような状況の中で、あなたはこの会社にシステムを継続的に運用するための担当者として採用されました。

![プロローグ](../../images/fadcd3507c63f192d2a650a20be97fe6f6c286f7.png)

# MINI QUEST

立ち上げられたオンラインゲームの名前は「MINI QUEST」です。

1986年に日本でデビューした非常に人気の高いロールプレイングゲームにインスパイアされており、レアアイテムを獲得するガチャシステムやゲーム内通貨を購入するマネタイズシステムなど、現代的な仕組みが取り入れられています。

![MINI QUEST](../../images/MINIQUEST.png)

# ミッション

この演習でのあなたのミッションは、このゲームシステムを安定して運用し、収益を上げるために尽力することです。

しかし、あなたが管理しなければならないオンラインゲームサーバーに対して、サイバー攻撃やゲームチート行為が向けられます。

サイバー攻撃やチート行為が横行するオンラインゲーム（オンラインゲームサーバーへのデータ改ざん、サービスの中断、頻発するチート事件など）では、正規ユーザーが減少し、利益を生み出せなくなります。

継続的に収益を生み出すために、以下を厳格に実施しなければなりません：

- サイバー攻撃からサーバーを守ること。
- チート行為からゲームを保護すること。

この演習では、ZANSINスコアリングモジュールがサーバー上の脆弱性の根本原因に対処できているかを評価します。

そのため、サイバー攻撃やゲームチートへの場当たり的な対策ではなく、脆弱性の修正に集中しましょう。

演習での攻撃は**4時間**で終了します。

演習開始から4時間以内に脆弱性の修正とインシデント対応を行い、高得点を目指してください。

# 演習環境

オンラインゲームサーバーの構成は以下の通りです：
単一のLinuxサーバー内でDockerを使用してさまざまなAPIが実装されています。

![環境](../../images/ffab4829c784d1661a4e16e3a519b740a2769823.png)

# ゲームAPI

オンラインゲームに実装されているAPIは以下の通りです：

- ユーザー登録API
- ログインAPI
- 退会API
- プレイヤーデータAPI
- 画像アップロードAPI
- バトルコース一覧API
- バトルコース決定API
- バトルAPI
- スタミナ回復API
- ガチャAPI
- ゲーム内購入API
- ランキングAPI

APIリファレンスは以下のリンクからダウンロードできます。

- [APIリファレンス](../API_Reference.pdf)

# ブラウザゲーム - 「MINI QUEST」

オンラインゲーム本体にアクセスする際は、HTTP（ポート80/tcp）でオンラインゲームサーバーのIPアドレスにアクセスするだけです。

`http://{IPアドレス}`

![MINI QUEST](../../images/MINIQUEST.gif)

> [!NOTE]
> ファイアウォールでHTTPがブロックされている場合、ブラウザを通じてゲームにアクセスするためにポートフォワーディングが必要になる場合があります。

## MINI QUESTの状態遷移図

ゲーム画面の遷移は以下の通りです：

![状態遷移図](../../images/7863d519ae098f9a4b0601e9abcf530d880a18db.png)

## 管理パネル

オンラインゲームサーバーの管理者として、ゲームプレイヤーを管理する機能があります。

`http://{IPアドレス}/user_list/`

不正なチート行為を行っているプレイヤーがいる場合は、「BAN!!」ボタンを使用してそのプレイヤーを削除できます。

![ユーザー管理](../../images/8f0da7656246ced22aaf5c8e86765978826c4de9.png)

## ユーザーランキング

このページでは、どのプレイヤーが好成績を収めているかを確認できます。
このページは公開ページであるため、誰でもアクセスできるようにしておく必要があります。

`http://{IPアドレス}/ranking/`

![ランキング](../../images/df9bb0949da341dd1bcedc7716577472bc492ad6.png)

# MINI QUESTサーバーのリファレンス

- ZANSINトレーニングマシンの認証情報

  |アカウント名|パスワード|備考|
  |----|----|----|
  |vendor|Passw0rd!23|必ずこのアカウントを使用してください！`sudo` が使えます。|
  |mario|Passw0rd!23||
  |link|Passw0rd!23||
  |sonic|Passw0rd!23||

- サービス一覧

  |サービス|備考|
  |----|----|
  |SSH| 認証情報: `vendor`/`Passw0rd!23`|
  |MySQL| 認証情報: `root` / `password`|
  |HTTP| ゲームページ: http://{IPアドレス}<br>管理ページ: http://{IPアドレス}/user_list/<br>ユーザーランキング: http://{IPアドレス}/ranking/<br>phpMyAdmin: http://{IPアドレス}:5555|

- ゲームAPI
  - ソースコードは以下のパスにあります：
    - `/home/vendor/game-api`
  - ゲームAPIのコンテナを起動/停止する場合は、以下を参照してください：
    - コンテナの起動
      - `docker-compose up -d`
    - コンテナの停止
      - `docker-compose down`


# 禁止事項

- **アクセス制御**
  - 送信元IPアドレスに基づくZANSINコントロールサーバーからの接続をブロックしないでください。
    - 正規ユーザーと攻撃者の両方の接続は、ZANSINコントロールサーバーの同一IPアドレスから発信されます。ブロックするとZANSINクローリングモジュールとスコアリングモジュールのサービスへのアクセスができなくなり、スコア評価が不可能になります。
    - 同様に、ZANSINクローリングモジュールとZANSINスコアリングモジュールの両方からの通信を妨げないよう注意してください。妨げるとゲームサーバーの収益が減少し、評価が不正確になる可能性があります。
- **API**
  - APIレスポンスのJSON構造を維持してください。
    - APIレスポンスの値は変更または削除できますが、キーを変更しないでください。キーを変更するとZANSINクローリングモジュールがレスポンスを取得できなくなります。
